#!/bin/bash

# Путь к установленной программе
TARGET_DIR="/Applications/BulbaGPT"

# 1. Находим папку приложения внутри (на всякий случай даем права и на .app)
APP_BUNDLE="$TARGET_DIR/BulbaGPT Studio.app"

# 2. Определяем реального пользователя (кто залогинен)
CURRENT_USER=$(scutil <<< "show State:/Users/ConsoleUser" | awk '/Name :/ { print $3 }')

# 3. Меняем владельца папки на текущего пользователя (чтобы Python мог писать файлы)
if [ -n "$CURRENT_USER" ] && [ "$CURRENT_USER" != "loginwindow" ]; then
    chown -R "$CURRENT_USER:staff" "$TARGET_DIR"
fi

# 4. САМОЕ ВАЖНОЕ: Делаем всё внутри папки исполняемым/доступным
# 755 = rwxr-xr-x (Владелец может всё, остальные читать и запускать)
chmod -R 755 "$TARGET_DIR"

exit 0